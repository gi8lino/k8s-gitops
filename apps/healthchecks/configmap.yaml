---
apiVersion: v1
kind: ConfigMap
metadata:
  name: prunes
  namespace: healthchecks
data:
  prunes: |
    #!/usr/bin/env bash

    function send_healthchecks {
      local send_failed="${1}"
      curl --retry 3 \
           --max-time 5 \
           --silent \
           --show-error \
           "${HEALTHCHECKS_URL}$([ -n "${send_failed}" ] && echo -n /fail)" > /dev/null
    }

    function notify {
      send_healthchecks true
      echo "ERROR: Unable to prune!"
    }

    trap notify ERR

    [[ -z "${HEALTHCHECKS_URL}" ]] && echo "HEALTHCHECKS_URL is not set!" && exit 1

    python3 /app/healthchecks/manage.py prunepings
    python3 /app/healthchecks/manage.py prunenotifications
    python3 /app/healthchecks/manage.py pruneusers
    python3 /app/healthchecks/manage.py prunetokenbucket
    python3 /app/healthchecks/manage.py pruneflips

    send_healthchecks
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: startup
  namespace: healthchecks
data:
  startup: |
    #!/usr/bin/env bash

    if ! command -v crond >/dev/null; then
      echo "crond not found"
      exit 1
    fi

    if ! curl --silent --fail http://localhost:8000/api/v1/status; then
      echo "healthchecks not ready"
      exit 1
    fi
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: logo
  namespace: healthchecks
binaryData:
  logo: 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
