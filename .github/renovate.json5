{
    "$schema": "https://docs.renovatebot.com/renovate-schema.json",
    "semanticCommits": "enabled",
    "dependencyDashboard": true,
    "separateMajorMinor": false,
    "timezone": "Europe/Zurich",
    "assignees": [
        "gi8lino"
    ],
    // container images
    "kubernetes": {
        "fileMatch": [
            "(apps|base|infra)/.*(cronjob|daemonset|deployment|statefulset)\\.yaml$"
        ]
    },
    // container images
    "helm-values": {
      "fileMatch": [
        "(apps|base|infra)/.*helmrelease\\.yaml$"
      ]
    },
    // helm releases
    "flux": {
      "fileMatch": [
        "((apps|base|infra)/(.+/)*helmrelease|core/helmrepositories/.*)\\.yaml$"
      ]
    },
    "regexManagers": [
        // dependencies for sync-cloudflare-nets
        {
            "fileMatch": [
                ".github/workflows/sync-cloudflare-nets\\.yaml$"
            ],
            "matchStrings": [
                "depName=(?<depName>.*)\\s.*/(?<currentValue>.*?)/"
            ],
            "datasourceTemplate": "github-releases"
        },
        {
          "fileMatch": [
              ".github/workflows/helm-release-differ\\.yaml$"
          ],
          "matchStrings": [
            "depName=(?<depName>.*)\\s.*version: (?<currentValue>.*)"
          ],
          "datasourceTemplate": "github-releases"
        },
        // crd releases for k8up & cloudflare-operator
        {
            "fileMatch": [
                "crds/(k8up|cloudflare-operator)/kustomization\\.yaml$"
            ],
            "matchStrings": [
                "datasource=(?<datasource>.*) depName=(?<depName>.*)\\s.*/(?<currentValue>.*?)/"
            ]
        },
        // crd releases for cert-manager
        {
            "fileMatch": [
                "crds/cert-manager/kustomization\\.yaml$"
            ],
            "matchStrings": [
                "registryUrl=(?<registryUrl>.*?) chart=(?<depName>.*?)\\s.*/(?<currentValue>.*?)/"
            ],
            "datasourceTemplate": "helm"
        },
        // crd releases for kube-prometheus-stack
        {
            "fileMatch": [
                "crds/kube-prometheus-stack/crds\\.yaml$"
            ],
            "matchStrings": [
                "registryUrl=(?<registryUrl>.*)\\s.*tag: (?<depName>.*)-(?<currentValue>.*)"
            ],
            "datasourceTemplate": "helm"
        },
        // crd releases for traefik
        {
            "fileMatch": [
                "crds/traefik/crds\\.yaml$"
            ],
            "matchStrings": [
                "registryUrl=(?<registryUrl>.*) chart=(?<depName>.*)\\s.*tag: v(?<currentValue>.*)"
            ],
            "datasourceTemplate": "helm"
        }
    ],
    "packageRules": [
        {
            "matchDatasources": [
                "docker",
                "helm",
                "github-releases",
                "github-tags"
            ],
            "matchUpdateTypes": [
                "patch",
                "minor",
                "major"
            ],
            "labels": [
                "renovate/{{datasource}}",
                "dep/{{updateType}}"
            ],
            "enabled": true
        },
        // special versioning for linuxserver.io images
        {
            "matchDatasources": [
                "docker"
            ],
            "matchPackagePatterns": [
                "^lscr.io/linuxserver/.*"
            ],
            "versioning": "regex:^v?(?<major>\\d{1,3})\\.(?<minor>\\d+)\\.(?<patch>\\d+)(.*-ls)?(?<build>\\d+)$"
        }
    ],
    "pre-commit": {
        "enabled": true
    }
}
