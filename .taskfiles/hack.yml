---
version: "3"
tasks:
  k:
    desc: Run generate_kustomizations.sh script
    cmds:
      - kustomizer -s ".img,dashboards,scripts" -s "flux/config/*" --silent cluster/
    silent: true
  s:
    desc: Run generate_secret_templates.sh script
    cmds:
      - ./hack/generate_secret_templates.sh
    silent: true
  check-selectors:
    desc: Check that network policy matchLabels selectors match live pods
    cmds:
      - python3 ./hack/check-policy-selectors.py
    silent: true
  list-hr-namespaces:
    desc: List namespaces referenced by HelmRelease manifests
    cmds:
      - ./hack/list_helmrelease_namespaces.sh {{.CLI_ARGS}}
    silent: true
  update-hr-alert:
    desc: Update Slack HelmRelease alert namespaces
    cmds:
      - ./hack/update_slack_helmrelease_alert.sh --alert-file cluster/flux/notifications/slack/alert.yaml {{.CLI_ARGS}}
    silent: true
  renovate-app-scopes:
    desc: Generate renovate appScopes.json5 file
    cmds:
      - ./hack/generate_renovate_app_scopes.sh
    silent: true
  cleanup-images-dry:
    desc: Cleanup CRI images
    cmds:
      - ./hack/cleanup_cri_images.py --sudo
    silent: true
  cleanup-images-run:
    desc: Cleanup CRI images
    cmds:
      - ./hack/cleanup_cri_images.py --sudo --apply
    silent: true
