---
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: EnvoyExtensionPolicy
metadata:
  name: block-admin-page
  namespace: keycloak
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: keycloak-external
  lua:
    - type: Inline
      inline: |
        function envoy_on_request(request_handle)
          if string.match(request_handle:headers():get(":path"), "^/admin") then
            request_handle:respond(
              {
                [":status"] = "403",
              },
              <!doctype html>
              <html lang="en">
                <head>
                  <meta charset="UTF-8" />
                  <title>Access Restricted</title>
                  <style>
                    body {
                      background: radial-gradient(circle at top, #2b2b3a, #111);
                      color: #f6f6ff;
                      font-family: "Inter", system-ui, sans-serif;
                      min-height: 100vh;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      margin: 0;
                    }
                    .card {
                      backdrop-filter: blur(16px);
                      background: rgba(14, 23, 40, 0.75);
                      border: 1px solid rgba(255, 255, 255, 0.08);
                      padding: 2.5rem;
                      border-radius: 1.5rem;
                      text-align: center;
                      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.45);
                      max-width: 32rem;
                    }
                    h1 {
                      margin: 0;
                      font-size: 2rem;
                      letter-spacing: -0.02em;
                    }
                    p {
                      margin: 1rem 0 0;
                      color: rgba(246, 246, 255, 0.8);
                    }
                    .hint {
                      margin-top: 1.5rem;
                      font-size: 0.9rem;
                      color: rgba(138, 180, 248, 0.9);
                    }
                  </style>
                </head>
                <body>
                  <div class="card">
                    <h1>403</h1>
                    <h1>Access Blocked</h1>
                    <p>Sorry buddy, you're not allowed to access this area.</p>
                  </div>
                </body>
              </html>

            )
          end
        end
